---
title:  "SkewC_Create_Coverage_Matrix"
author: "Imad Abugessaisa: Laboratory for Large-Scale Biomedical           Data Technology - RIKEN-IMS"
date:    "April 06, 2020"
output: html_document
params:
  coverage: coverage.r
---

```{r echo=FALSE}
knitr::opts_knit$set(verbose = TRUE)
options(width=100)
```

## SkewC

This is an R Markdown document to create the required coverage matrixes. The input is the vector of the normalized values from the genebody coverge script (coverage.r)file. In this file, each single-cell has a vector of numerical values. The each cell has a cell id with prefix SCC_

```{r load required libraries}
library(magicfor)
library(reshape2)
library(ggplot2)
library(dplyr)
```

##


```{r Read the input gene body coverage vector file .r}
## Source the coverage.r file
source(params$coverage)
## In put the dataset title. The dataset title will be used
## to label the output plots
DatasetTitle <- readline(prompt = "What is the dataset title?")
```

##
```{r Creat list var}
## Initation of the initiation of variables and coverageValues
## list
vars <- ls(pattern = "SCC_")
nvars <- length(vars)
CoverageValues <- list()
j <- 1
for (i in 1:nvars)
{
if (class(get(vars[i])) == "numeric")
{
CoverageValues[[j]] <- get(vars[i])
names(CoverageValues)[j] <- vars[i]
j <- j + 1
}
}
```
##
```{r Create R data frame of the coverage matrix}
## The data frame name Coverage_DF
## Coverage_DF consists of 100 columns [pmean1..pmean100] plus the ## cell ID column "Annotation"

magic_for(silent = TRUE)
for (h in vars)
{
for (z in 1:100) {
nam <- paste("pmean", z, sep = "")
assign(nam, CoverageValues[[h]][z])
}

  put(
    pmean1,
    pmean2,
    pmean3,
    pmean4,
    pmean5,
    pmean6,
    pmean7,
    pmean8,
    pmean9,
    pmean10,
    pmean11,
    pmean12,
    pmean13,
    pmean14,
    pmean15,
    pmean16,
    pmean17,
    pmean18,
    pmean19,
    pmean20,
    pmean21,
    pmean22,
    pmean23,
    pmean24,
    pmean25,
    pmean26,
    pmean27,
    pmean28,
    pmean29,
    pmean30,
    pmean31,
    pmean32,
    pmean33,
    pmean34,
    pmean35,
    pmean36,
    pmean37,
    pmean38,
    pmean39,
    pmean40,
    pmean41,
    pmean42,
    pmean43,
    pmean44,
    pmean45,
    pmean46,
    pmean47,
    pmean48,
    pmean49,
    pmean50,
    pmean51,
    pmean52,
    pmean53,
    pmean54,
    pmean55,
    pmean56,
    pmean57,
    pmean58,
    pmean59,
    pmean60,
    pmean61,
    pmean62,
    pmean63,
    pmean64,
    pmean65,
    pmean66,
    pmean67,
    pmean68,
    pmean69,
    pmean70,
    pmean71,
    pmean72,
    pmean73,
    pmean74,
    pmean75,
    pmean76,
    pmean77,
    pmean78,
    pmean79,
    pmean80,
    pmean81,
    pmean82,
    pmean83,
    pmean84,
    pmean85,
    pmean86,
    pmean87,
    pmean88,
    pmean89,
    pmean90,
    pmean91,
    pmean92,
    pmean93,
    pmean94,
    pmean95,
    pmean96,
    pmean97,
    pmean98,
    pmean99,
    pmean100
    )
}
Coverage_DF <- magic_result_as_dataframe()
names(Coverage_DF)[1] <- "Annotation"
## Remove the prefix string from the Coverage_means_DF
dfv <- as.character('SCC_')
Coverage_DF$Annotation <- gsub(dfv, "", Coverage_DF$Annotation)
## Remove the prefix string from the Coverage_means_DF


```

```{r }
## Compute the mean coveage matrix Coverage_means_DF
## The data frame name Coverage_means_DF
## Coverage_means_DF consists of 10 columns [pmean10..pmean100] plus the ## cell ID column "Annotation"
Coverage_means_DF <- Coverage_DF
p10 <- c(names(Coverage_means_DF)[2:11])
p20 <- c(names(Coverage_means_DF)[12:21])
p30 <- c(names(Coverage_means_DF)[22:31])
p40 <- c(names(Coverage_means_DF)[32:41])
p50 <- c(names(Coverage_means_DF)[42:51])
p60 <- c(names(Coverage_means_DF)[52:61])
p70 <- c(names(Coverage_means_DF)[62:71])
p80 <- c(names(Coverage_means_DF)[72:81])
p90 <- c(names(Coverage_means_DF)[82:91])
p100 <- c(names(Coverage_means_DF)[92:101])

############################
### {r compute row_mean}

Coverage_means_DF$pmeanAve10 <-
  rowMeans(Coverage_means_DF[c(p10)],na.rm=TRUE)
Coverage_means_DF$pmeanAve20 <-
  rowMeans(Coverage_means_DF[c(p20)],na.rm=TRUE)
Coverage_means_DF$pmeanAve30 <-
  rowMeans(Coverage_means_DF[c(p30)],na.rm=TRUE)
Coverage_means_DF$pmeanAve40 <-
  rowMeans(Coverage_means_DF[c(p40)],na.rm=TRUE)
Coverage_means_DF$pmeanAve50 <-
  rowMeans(Coverage_means_DF[c(p50)],na.rm=TRUE)
Coverage_means_DF$pmeanAve60 <-
  rowMeans(Coverage_means_DF[c(p60)],na.rm=TRUE)
Coverage_means_DF$pmeanAve70 <-
  rowMeans(Coverage_means_DF[c(p70)],na.rm=TRUE)
Coverage_means_DF$pmeanAve80 <-
  rowMeans(Coverage_means_DF[c(p80)],na.rm=TRUE)
Coverage_means_DF$pmeanAve90 <-
  rowMeans(Coverage_means_DF[c(p90)],na.rm=TRUE)
Coverage_means_DF$pmeanAve100 <-
  rowMeans(Coverage_means_DF[c(p100)],na.rm=TRUE)
## {r write final output to R data frame}
Coverage_means_DF <- Coverage_means_DF[,-c(2:101)]
## Save Coverage_means_DF as Coverage_means_DF_Clust for Trim ## clustering use
Coverage_means_DF_Clust <- Coverage_means_DF
```
